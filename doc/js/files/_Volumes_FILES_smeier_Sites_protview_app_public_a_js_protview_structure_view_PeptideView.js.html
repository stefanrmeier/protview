<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>&#x2F;Volumes&#x2F;FILES&#x2F;smeier&#x2F;Sites&#x2F;protview&#x2F;app&#x2F;public&#x2F;a&#x2F;js&#x2F;protview&#x2F;structure&#x2F;view&#x2F;PeptideView.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Core.View.html">Core.View</a></li>
            
                <li><a href="..&#x2F;classes/DrawBoard.Module.html">DrawBoard.Module</a></li>
            
                <li><a href="..&#x2F;classes/Structure.Model.Peptide.html">Structure.Model.Peptide</a></li>
            
                <li><a href="..&#x2F;classes/Structure.Model.Protein.html">Structure.Model.Protein</a></li>
            
                <li><a href="..&#x2F;classes/Structure.Module.html">Structure.Module</a></li>
            
                <li><a href="..&#x2F;classes/Structure.View.NewProteinView.html">Structure.View.NewProteinView</a></li>
            
                <li><a href="..&#x2F;classes/Structure.View.PeptideView.html">Structure.View.PeptideView</a></li>
            
                <li><a href="..&#x2F;classes/Structure.View.ProteinView.html">Structure.View.ProteinView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/Application.html">Application</a></li>
            
                <li><a href="..&#x2F;modules/Core.html">Core</a></li>
            
                <li><a href="..&#x2F;modules/DrawBoard.html">DrawBoard</a></li>
            
                <li><a href="..&#x2F;modules/Structure.html">Structure</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: &#x2F;Volumes&#x2F;FILES&#x2F;smeier&#x2F;Sites&#x2F;protview&#x2F;app&#x2F;public&#x2F;a&#x2F;js&#x2F;protview&#x2F;structure&#x2F;view&#x2F;PeptideView.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * 
 * Handles and shows peptide form
 * 
 * 
 * @module Structure
 * @namespace Structure.View
 * @class PeptideView
 * @extends Core.View
 * 
 * @author Stefan Meier
 * @version 20120903
 * 
 *&#x2F;
ProtView.Structure.View.PeptideView = ProtView.Core.View.extend({
	events : {
		&#x2F;**
		 * @event click #peptide-form-submit
		 *&#x2F;
		&#x27;click #peptide-form-submit&#x27; : &#x27;submitForm&#x27;
	},
	&#x2F;**
	 * Handles form submit
	 * 
	 * @method submitForm
	 * @param {Object} event
	 *&#x2F;
	submitForm : function(e) {
		e.preventDefault();
		var model = this.model;
		&#x2F;&#x2F;reads current n-terminus value and updates model
		var terminusN = $(&#x27;#peptide-terminus-n&#x27;).val();
		model.set({
			terminusN : terminusN
		}, {
			silent : true
		});

		&#x2F;&#x2F;reads current c-terminus value and updates model
		var terminusC = $(&#x27;#peptide-terminus-c&#x27;).val();
		model.set({
			terminusC : terminusC
		}, {
			silent : true
		});
		
		var sequence = $(&#x27;#peptide-sequence&#x27;).val();
		
		model.set({
			sequence : sequence
		}, {
			silent : true
		});

		&#x2F;&#x2F;reads current membrane regions and updates model
		var regions = this.evaluateRegions();
		model.set({
			regions : regions
		}, {
			silent : true
		});

		&#x2F;&#x2F;validates model manually
		var valid = model.isValid(true);

		&#x2F;&#x2F;if model is valid, content is saved
		if (valid) {
			this.model = model;
			this.controller.save();
		}
	},
	&#x2F;**
	 * Gets membrane regions from form
	 * 
	 * @method evaluateRegions
	 * @return {Object} regions
	 *&#x2F;
	evaluateRegions : function() {
		var regions = [];
		var region = {};
		$(&#x27;#peptide-regions-values li&#x27;).each(
				function() {
					var child = $(this).children();
					child.each(function(k, v) {
						var el = $(v).get(0);

						if (el.tagName.toLowerCase() == &#x27;input&#x27;) {
							&#x2F;&#x2F; peptide-region_from-1
							var input = $(el);

							var inputId = input.attr(&#x27;id&#x27;);

							&#x2F;&#x2F; pos = before _
							var posUnderscore = inputId.indexOf(&#x27;_&#x27;);
							var posLastDash = inputId.lastIndexOf(&#x27;-&#x27;);
							&#x2F;&#x2F; from, to
							var pos = inputId.substring(posUnderscore + 1,
									posLastDash);
							var id = inputId.substring(posLastDash + 1);
							region.id = Number(id);

							var inputVal = input.val();

							if (inputVal != &#x27;&#x27;) {
								&#x2F;&#x2F; {id: 0, start: 0, end: 0}
								if (pos == &#x27;from&#x27;) {
									region.start = Number(inputVal);
								} else if (pos == &#x27;to&#x27;) {
									region.end = Number(inputVal);
									regions.push(region);
									region = {};
								}
							}
						}

					});
				});
		return regions;
	},
	&#x2F;**
	 * Converts regions to HTML
	 * 
	 * @method {Object} regions
	 * @return {string} htmlRegions
	 *&#x2F;
	renderRegion : function(regions) {
		var ret = &#x27;&lt;div class=&quot;control-group&quot;&gt; &#x27;;
		ret += &#x27;&lt;label for=&quot;peptide-region-1&quot; id=&quot;peptide-region-label&quot; &#x27;;
		ret += &#x27;class=&quot;control-label&quot;&gt;Membrane regions&lt;&#x2F;label&gt; &#x27;;
		ret += &#x27;&lt;div class=&quot;controls&quot;&gt; &#x27;;
		ret += &#x27;&lt;ol id=&quot;peptide-regions-values&quot;&gt;&#x27;;
		_.each(regions, function(val, key) {
			ret += &#x27;&lt;li style=&quot;margin-left: 20px; margin-bottom: 9px;&quot;&gt;&#x27;;
			ret += &#x27;From : &lt;input type=&quot;text&quot; class=&quot;input-xmini inline&quot;&#x27;;
			ret += &#x27;name=&quot;peptide-region_from-&#x27; + val.id + &#x27;&quot; &#x27;;
			ret += &#x27;id=&quot;peptide-region_from-&#x27; + val.id + &#x27;&quot; &#x27;;
			ret += &#x27;value=&quot;&#x27; + val.start + &#x27;&quot;&gt; &#x27;;
			ret += &#x27;To : &lt;input type=&quot;text&quot; class=&quot;input-xmini inline&quot; &#x27;;
			ret += &#x27;name=&quot;peptide-region_to-&#x27; + val.id + &#x27;&quot; &#x27;;
			ret += &#x27;id=&quot;peptide-region_to-&#x27; + val.id + &#x27;&quot; &#x27;;
			ret += &#x27;value=&quot;&#x27; + val.end + &#x27;&quot;&gt;&#x27;;
			ret += &#x27; &lt;i class=&quot;icon-minus remove_row&quot;&gt;&lt;&#x2F;i&gt;&#x27;;
			ret += &#x27;&lt;&#x2F;li&gt;&#x27;;
		});
		ret += &#x27;&lt;li style=&quot;margin-left: 20px; margin-bottom: 9px;&quot;&gt;&#x27;;
		ret += &#x27;&lt;i class=&quot;icon-plus add_row&quot;&gt;&lt;&#x2F;i&gt;&#x27;;
		ret += &#x27;&lt;&#x2F;li&gt;&#x27;;
		ret += &#x27;&lt;&#x2F;ol&gt;&lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&#x27;;
		return ret;
	},
	&#x2F;**
	 * Creates a new membrane region form row
	 * 
	 * @method newRow
	 * @return {string} htmlRegionRow
	 *&#x2F;
	newRow : function() {
		ret = &#x27;&#x27;;
		ret += &#x27;&lt;li style=&quot;margin-left: 20px; margin-bottom: 9px;&quot;&gt;&#x27;;
		ret += &#x27;From : &lt;input type=&quot;text&quot; class=&quot;input-xmini inline&quot;&#x27;;
		ret += &#x27;name=&quot;peptide-region_from-0&quot; &#x27;;
		ret += &#x27;id=&quot;peptide-region_from-0&quot; &#x27;;
		ret += &#x27;value=&quot;&quot;&gt; &#x27;;
		ret += &#x27;To : &lt;input type=&quot;text&quot; class=&quot;input-xmini inline&quot; &#x27;;
		ret += &#x27;name=&quot;peptide-region_to-0&quot; &#x27;;
		ret += &#x27;id=&quot;peptide-region_to-0&quot; &#x27;;
		ret += &#x27;value=&quot;&quot;&gt; &#x27;;
		ret += &#x27;&lt;i class=&quot;icon-minus remove_row&quot;&gt;&lt;&#x2F;i&gt;&#x27;;
		ret += &#x27;&lt;&#x2F;li&gt;&#x27;;
		ret += &#x27;&lt;&#x2F;ol&gt;&lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&#x27;;
		return ret;
	},
	&#x2F;**
	 * Binds the remove row event to the minus button after each region row
	 *
	 * @method bindRemoveRowEvent
	 * @return {string} htmlRegionRow
	 *&#x2F;
	bindRemoveRowEvent: function() {
		$(&#x27;.remove_row&#x27;).click(function() {
			var currentRow = $(this).parent();
			currentRow.remove();
		});
	},
	&#x2F;**
	 * Renders peptide view
	 *
	 * @method render
	 * @chainable
	 *&#x2F;
	render : function() {
		var self = this;
		var renderedContent = self.template(self.model.toJSON()),
		renderedRegions = this.renderRegion(self.model
				.get(&#x27;regions&#x27;));

		$(&#x27;#peptide-form-insert&#x27;).html(renderedContent + renderedRegions);

		Backbone.Validation.bind(self);
		
		self.bindRemoveRowEvent();
		
		$(&#x27;.add_row&#x27;).click(function() {
			var currentRow =  $(this).parent();
			var newRow = self.newRow();
			currentRow.before(newRow);
			
			self.bindRemoveRowEvent();
		});

		return self;
	},
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
